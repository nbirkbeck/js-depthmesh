<html>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/three.js/r61/three.js"> </script>


<body>
<div id='container' title='Basis images'>
</div>

<script>

function loadShader(url) {
  var shaderSrc;
  var result = jQuery.ajax(url, {
    async: false,
    success: function(data, status) {
      shaderSrc = data;
    },
    error: function() { 
      console.log('error');
    }
  });
  return shaderSrc;
}

var scene = new THREE.Scene();

var renderer = new THREE.WebGLRenderer();
renderer.setSize(800, 800);
renderer.setDepthTest(true);
renderer.setDepthWrite(true);

renderer.setClearColor(0x000000, 1);

/** @type {!THREE.PerspectiveCamera} */
var camera = new THREE.PerspectiveCamera(70, 1.0, 0.3, 2000);
camera.position.z = 5;
camera.position.x = 0;
camera.rotation.y = 0;
container.appendChild(renderer.domElement);

var light = new THREE.DirectionalLight();
scene.add(light);
light.position.set(0, 0, 1);

var texture = THREE.ImageUtils.loadTexture("textures/depth.png");
texture.wrapS = THREE.RepeatWrapping;
texture.wrapT = THREE.RepeatWrapping;

var color = THREE.ImageUtils.loadTexture("textures/image.png");
color.wrapS = THREE.RepeatWrapping;
color.wrapT = THREE.RepeatWrapping;

var uniforms = {
  depth: { type: 't', value: texture },
  color: { type: 't', value: color }
};
var plane = new THREE.PlaneGeometry(1, 1, 200, 200);
var planeMat = new THREE.ShaderMaterial({
  vertexShader: loadShader('shaders/vert.vsh'),
  fragmentShader: loadShader('shaders/frag.fsh'),
  uniforms: uniforms
});
planeMat.alphaTest = 0.4;
planeMat.transparent = true;
var planeMesh = new THREE.Mesh(plane, planeMat);
planeMesh.rotation.y = 0.6;
planeMesh.rotation.z = 3.14;
scene.add(planeMesh);

var y = 0;
setInterval(function() {
  y += 0.1;
  planeMesh.rotation.y = Math.sin(y) * 0.0725;
  renderer.render(scene, camera);
}, 100);

</script>
</html>
